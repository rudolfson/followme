<!DOCTYPE html>
<html>
<head>
    <title>Followme</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css"/>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        var OpenStreetMap_DE = L.tileLayer('http://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png', {
                               maxZoom: 18,
                               attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'});
        var Thunderforest_OpenCycleMap = L.tileLayer('http://{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png', {
                                         attribution: '&copy; <a href="http://www.opencyclemap.org">OpenCycleMap</a>,'
                                             + ' &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'});
        var HikeBike_HikeBike = L.tileLayer('http://{s}.tiles.wmflabs.org/hikebike/{z}/{x}/{y}.png', {
                                maxZoom: 19,
                                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'});
        var Thunderforest_Outdoors = L.tileLayer('http://{s}.tile.thunderforest.com/outdoors/{z}/{x}/{y}.png', {
                                     attribution: '&copy; <a href="http://www.opencyclemap.org">OpenCycleMap</a>,'
                                        + ' &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'});
        var Mapbox = L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
                     maxZoom: 18,
                     attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                                  '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                                  'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
                     id: 'examples.map-i875mjb7'});
        var MapQuestOpen_OSM = L.tileLayer('http://otile{s}.mqcdn.com/tiles/1.0.0/{type}/{z}/{x}/{y}.{ext}', {
                               type: 'map',
                               ext: 'jpg',
                               attribution: 'Tiles Courtesy of <a href="http://www.mapquest.com/">MapQuest</a>'
                                            + ' &mdash; Map data &copy;'
                                            + ' <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
                               subdomains: '1234'});
        var map = L.map('map', {
                center: [50.719114, 7.117572],
                zoom: 10,
                layers: [OpenStreetMap_DE]
        });
        var baseMaps = {
            "Openstreetmap DE": OpenStreetMap_DE,
            "Opencyclemap": Thunderforest_OpenCycleMap,
            "HikeBike": HikeBike_HikeBike,
            "Outdoors": Thunderforest_Outdoors,
            "Mapbox": Mapbox,
            "Mapquest": MapQuestOpen_OSM
        };
        var layersControl = L.control.layers(baseMaps);
        map.addControl(layersControl);
        var marker = L.marker([50.719114, 7.117572]);
        marker.addTo(map);

        var name = document.location.hash || '#default';
        name = name.substr(1);
        var center = true;

        var refresh = function() {
            $.getJSON("recording/" + name, function(data) {
                if (data.error) { alert('Error: ' + data.error) }
                if (data.lat && data.lon) {
                    // Update marker
                    marker.setLatLng([data.lat,data.lon]);
                    if (center) {
                        map.setView( [data.lat,data.lon], 16 );
                        center = false;
                    }
                }

            });
        };
        refresh();
        setInterval(refresh, 20000);
    </script>
</html>
